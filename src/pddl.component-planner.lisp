#|
  This file is a part of pddl.component-planner project.
  Copyright (c) 2013 guicho ()
|#

(in-package :pddl.component-planner)

(cl-syntax:use-syntax :annot)
;; blah blah blah.

@export
(defun build-component-problem (abstract-task)
  "build a small problem which contains only the relevant objects in a
abstract task."
  (ematch abstract-task
    ((abstract-component-task :problem *problem*)
     (ematch *problem*
       ((pddl-problem :name total-name
                      :domain *domain*
                      :objects objs
                      :init init
                      :metric metric)
        (match abstract-task
          ((abstract-component-task- (ac (abstract-component components))
                                     (goal task-goal))
           (let* ((removed nil)
                  (new-objs
                   (remove-if
                    (lambda (o)
                      (when (some (lambda (comp)
                                    (and (pddl-supertype-p (type o) (type comp))
                                         (not (eq comp o))))
                                  components)
                        (push o removed)
                        t))
                    objs)))
             @ignorable new-objs
             (format t "狺蕃唼轶蝈盹鲥濑ア磲疸狎＇钺礤蝈盹鲥洎痄潇痱镡戾轰镯衢滹磲轭侯犴ㄡ痧禊＇泔钽狒孱狒瀛簌礅镬麸翎飙钺礤с镯痫铄铘磲疸狎＇钺礤泔眇镱孱趔┅猴怅邈趔铄鳝镡牦换镡牦洪铋蝈盹鲥殒灬礅溽ㄦ箫礤灬礅溽皓ㄦ轭蝈盹鲥洎疳蜥礤翦蝮姗┅轭轸虹镝扉篝п钿翎箅顼犰喉弭蜷礤趄殂┅┅┅┅厘痫螋ㄤ彐汜汨邃痨犷翎箅翎箅⒚犰祗怩殪洵泔眇镱孱舡痱镡戾憩磲脲痨犷鏖翳颇翳孱疳蝮翳蝈篚祠螽蝈趱蝾心奶刑廖戾舄è痱镡戾愍ㄢ蹰熹泔眇镱孱舡痱镡戾翎箅┅í滹磲轭ㄤ镯衢痱镡戾愍┅磲疸狎戾è癌ㄣ躜蝙＇痄潇痨犷侯犴ㄣ镱汜翦钺翦簌礅镬钺礤痱镡戾愍ю灬ㄩ钽椹吼狒瑭翦篝痱镡戾黩轸瀛痱镡戾痱镡戾愍疳翳滹磲轭呼轫瀛扉黹鸿狎洵糸礤扉黹备鞍喉屙矧蛋鞍鞍换蛋巴换猴痿轱铙箦狎汨狍翎颞祉沲舁┅┅┅厘痫螋ㄤ彐躅沆遽颦痨犷翎箅汜汨īㄣ戾狎汜汨刑廖粤铀昧萌弄┅厘痫螋ㄤ彐躅翎箅痨犷羼踽舯舨换ㄡ篌弪ㄡ怏趄徙舡泔眇镱孱舡翎箅篝蜷泗舯舨┅戾舄è痱镡戾换棱蝈犭ㄢ蹰熹泔眇镱孱舡痱镡戾舨┅痱镡戾憝疳翳换棱蝈犭黩轸瀛痱镡戾痱镡戾愆┅箫礤灬礅溽痨犷鲠扉溽翦痨犷疳翳ㄤ镯衢痱镡戾愆痱镡戾憝疳翳黩轸瀛痨犷ㄡ痧禊磲痧轭痨犷磲痧轭绛忮赭邋瞽翎箅舯舨痱镡戾愆换忽弪怙箦┅痨犷翎箅舯┅┅厘痫螋ㄤ彐躅骒蹂铘禊泔铑邈翦洵镡赍泗ㄣ镯痫铄铘狒趄殁豸弩姗戾è痼疳蜥礤翦蝮姗┅箦翩痼箦舡溟骀弪孱沐痼泔眇镱孱趔┅箦翩痼箦舡溟骀弪孱沐痼狒趄殁豸弩┅痼┅厘痫螋ㄤ彐躅顼犰镡赍泗翎箅ㄥ磲翥翎箅è徕篝蜥泗泔眇镱孱舡翎箅顼犰ㄡㄡ怏趄徙舡泔眇镱孱泔眇镱孱趔狒趄殁豸弩┅磲痧孱ㄣ躜蝙＇骒蹂铘禊泔铑邈翦洵镡赍泗泔眇镱孱趔狒趄殁豸弩顼犰┅┅厘痫螋ㄤ彐躅轭轸镡赍泗翎箅ㄥ磲翥翎箅è徕篝蜥泗泔眇镱孱舡翎箅轭轸ㄡㄡ怏趄徙舡泔眇镱孱泔眇镱孱趔狒趄殁豸弩┅磲痧孱ㄣ躜蝙＇骒蹂铘禊泔铑邈翦洵镡赍泗泔眇镱孱趔狒趄殁豸弩轭轸┅┅厘痫螋ㄤ彐躅磲痧轭绛忮赭邋瞽翎箅舯舨扉篝赭锃扉篝磲痧轭ㄡ怏趄徙舡泔眇镱孱舡泔眇镱孱趔ㄡ怏趄徙舡泔眇镱孱舡翎箅徙舯┅ㄡ怏趄徙舡泔眇镱孱舡泔眇镱孱趔ㄡ怏趄徙舡泔眇镱孱舡翎箅徙舨┅赭锃扉篝磲痧轭ㄩ铋舡镡赍泗舯ㄩ铋舡镡赍泗舨┅赭锃扉篝磲痧轭ㄧ镝飙镡赍泗舯ㄧ镝飙镡赍泗舨┅┅厘痫螋ㄤ彐躅赭锃扉篝磲痧轭矬矬博磲疸狎灬礅溽锉锊ㄣ镱锉锊┅矬矬博厘痫螋ㄤ彐躅狃痨磲痧轭痨犷磲痧轭磲痧邃痱镡戾愆ㄥ磲翥痨犷è痄潇痨犷徙糸镱痱镡戾愆戾èロ狃痖铉换棱蝈犭ē蝈盹鲥铒汨犷珏磲痧轭绌┅箬犰祜鳝泔瘗痨犷吼蝻忪屙磲痧邃痱镡戾侯犴ㄣ镱汜翦钺翦簌礅镬ю灬瞽磲痧邃骝镯钺礤痨犷麸钺礤磲痧邃痱镡戾愆横泗轱铙换棱蝈犭磲鲥泗矧灬礅溽ㄡ泗轱瞟ㄥ磲翥徙糸镱è矧痄潇轭轸獒飙徙糸镱痄潇顼犰徙糸镱┅徙糸镱è痄潇轭翦蝽邃獒翦徙糸镱疳蜥礤翦蝮箬犰祜鳝泔瘗徙糸镱吼狎犴弭弪ē狃痨疳蜥礤翦蝮ロ狃痖铉┅┅徙糸镱螬┅┅ㄤ彐躅メ痧禊疳蜥礤翦蝮磲痧轭珞蝈漉沐灬礅溽疳蜥礤翦蝮磲痧轭绌ㄥ磲翥磲痧轭è泔铙骝镯麸篚怏糸趱翦麸骝镯疳蜥礤翦蝮┅┅磲痧轭珞洪铋糸犰鲠祯疳蜥礤翦蝮┅ㄤ彐躅ヲ屙秭瀛铒汨犷珏磲痧轭绌ㄥ磲翥磲痧轭è扉篝泔眇镱孱舡磲痧轭轭轸磲痧轭顼犰磲痧轭绌ㄦ戾è骖磲痧轭绌ㄥ磲翥磲痧轭è泔铙骝镯麸ㄥ骝镯麸┅┅ㄡ痧孱泔眇镱孱舡磲痧轭蝈盹鲥殒＇骖轭轸磲痧轭绌蝈盹鲥殒＇骖顼犰磲痧轭绌┅┅